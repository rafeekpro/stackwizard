# 🔄 Development Workflow

Best practices and workflows for developing applications generated by StackWizard.

## 🚀 Getting Started

### Initial Setup

```bash
# 1. Generate project
npx @rafeekpro/stackwizard my-project

# 2. Navigate to project
cd my-project

# 3. Initialize git repository
git init
git add .
git commit -m "Initial commit from StackWizard"

# 4. Create GitHub repository
gh repo create my-project --public --source=. --remote=origin --push

# 5. Start development environment
docker-compose up -d

# 6. View logs
docker-compose logs -f
```

## 🏗️ Development Environment

### VS Code Setup

#### Recommended Extensions

```json
// .vscode/extensions.json
{
  "recommendations": [
    // Python
    "ms-python.python",
    "ms-python.vscode-pylance",
    "ms-python.black-formatter",
    
    // JavaScript/React
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "dsznajder.es7-react-js-snippets",
    
    // Docker
    "ms-azuretools.vscode-docker",
    "ms-vscode-remote.remote-containers",
    
    // Database
    "mtxr.sqltools",
    "mtxr.sqltools-driver-pg",
    
    // Git
    "eamodio.gitlens",
    "mhutchie.git-graph",
    
    // Utilities
    "christian-kohler.path-intellisense",
    "formulahendry.auto-rename-tag",
    "yzhang.markdown-all-in-one"
  ]
}
```

#### Workspace Settings

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "python.linting.enabled": true,
  "python.linting.pylintEnabled": false,
  "python.linting.flake8Enabled": true,
  "python.formatting.provider": "black",
  "[python]": {
    "editor.defaultFormatter": "ms-python.black-formatter"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "files.exclude": {
    "**/__pycache__": true,
    "**/.pytest_cache": true,
    "**/node_modules": true,
    "**/.next": true,
    "**/dist": true,
    "**/build": true
  }
}
```

### Development Tools Setup

#### Pre-commit Hooks

```yaml
# .pre-commit-config.yaml
repos:
  # Python
  - repo: https://github.com/psf/black
    rev: 23.1.0
    hooks:
      - id: black
        language_version: python3.11
        
  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args: ['--max-line-length=88', '--extend-ignore=E203']
        
  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ['--profile', 'black']
        
  # JavaScript
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v8.36.0
    hooks:
      - id: eslint
        files: \.[jt]sx?$
        types: [file]
        additional_dependencies:
          - eslint@8.36.0
          - eslint-config-react-app
          
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v2.7.1
    hooks:
      - id: prettier
        types_or: [javascript, jsx, ts, tsx, css, scss, json, markdown]
        
  # General
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-merge-conflict
      - id: detect-private-key
```

Install pre-commit:
```bash
pip install pre-commit
pre-commit install
pre-commit run --all-files  # Test run
```

## 💻 Backend Development

### Development Workflow

```bash
# 1. Create feature branch
git checkout -b feature/user-authentication

# 2. Start backend in watch mode
docker-compose up backend

# 3. Make changes to code
# FastAPI auto-reloads on file changes

# 4. Create/modify database models
vim backend/app/models/new_model.py

# 5. Generate migration
docker-compose exec backend alembic revision --autogenerate -m "Add new model"

# 6. Apply migration
docker-compose exec backend alembic upgrade head

# 7. Test your changes
docker-compose exec backend pytest

# 8. Check API documentation
open http://localhost:8000/docs
```

### Adding New Endpoints

```python
# backend/app/api/v1/endpoints/new_endpoint.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List

from app.api import deps
from app.crud import crud_item
from app.schemas import Item, ItemCreate

router = APIRouter()

@router.get("/", response_model=List[Item])
def read_items(
    db: Session = Depends(deps.get_db),
    skip: int = 0,
    limit: int = 100,
    current_user = Depends(deps.get_current_user),
):
    """
    Retrieve items.
    """
    items = crud_item.get_multi_by_owner(
        db, owner_id=current_user.id, skip=skip, limit=limit
    )
    return items

@router.post("/", response_model=Item)
def create_item(
    *,
    db: Session = Depends(deps.get_db),
    item_in: ItemCreate,
    current_user = Depends(deps.get_current_user),
):
    """
    Create new item.
    """
    item = crud_item.create_with_owner(
        db, obj_in=item_in, owner_id=current_user.id
    )
    return item
```

### Database Migrations

```bash
# Create new migration
docker-compose exec backend alembic revision --autogenerate -m "Description"

# Apply migrations
docker-compose exec backend alembic upgrade head

# Rollback one migration
docker-compose exec backend alembic downgrade -1

# View migration history
docker-compose exec backend alembic history

# Generate SQL for migration
docker-compose exec backend alembic upgrade head --sql
```

### Testing Backend

```bash
# Run all tests
docker-compose exec backend pytest

# Run with coverage
docker-compose exec backend pytest --cov=app --cov-report=html

# Run specific test file
docker-compose exec backend pytest tests/test_api/test_users.py

# Run with verbose output
docker-compose exec backend pytest -vv

# Run only marked tests
docker-compose exec backend pytest -m "not slow"
```

## ⚛️ Frontend Development

### Development Workflow

```bash
# 1. Start frontend dev server
docker-compose up frontend

# 2. Create new component
touch frontend/src/components/NewComponent.js

# 3. Hot reload is automatic
# Make changes and see them instantly

# 4. Run tests
docker-compose exec frontend npm test

# 5. Build for production
docker-compose exec frontend npm run build
```

### Creating Components

```jsx
// frontend/src/components/UserProfile.js
import React, { useState, useEffect } from 'react';
import { Card, CardContent, Typography, Avatar } from '@mui/material';
import { useAuth } from '../contexts/AuthContext';
import { userService } from '../services/users';

const UserProfile = () => {
  const { user } = useAuth();
  const [profile, setProfile] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchProfile = async () => {
      try {
        const data = await userService.getProfile();
        setProfile(data);
      } catch (error) {
        console.error('Failed to fetch profile:', error);
      } finally {
        setLoading(false);
      }
    };

    if (user) {
      fetchProfile();
    }
  }, [user]);

  if (loading) return <div>Loading...</div>;
  if (!profile) return <div>No profile data</div>;

  return (
    <Card>
      <CardContent>
        <Avatar src={profile.avatar} />
        <Typography variant="h5">{profile.full_name}</Typography>
        <Typography variant="body2">{profile.email}</Typography>
      </CardContent>
    </Card>
  );
};

export default UserProfile;
```

### Adding Routes

```jsx
// frontend/src/App.js
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import NewPage from './pages/NewPage';

function App() {
  return (
    <Router>
      <Routes>
        {/* Add new route */}
        <Route path="/new-page" element={<NewPage />} />
      </Routes>
    </Router>
  );
}
```

### Testing Frontend

```bash
# Run tests
docker-compose exec frontend npm test

# Run tests in watch mode
docker-compose exec frontend npm test -- --watchAll

# Run with coverage
docker-compose exec frontend npm test -- --coverage

# Run E2E tests (if configured)
docker-compose exec frontend npm run test:e2e
```

## 🔄 Git Workflow

### Branching Strategy

```bash
main                 # Production-ready code
├── develop         # Integration branch
    ├── feature/*   # New features
    ├── bugfix/*    # Bug fixes
    ├── hotfix/*    # Urgent fixes
    └── release/*   # Release preparation
```

### Commit Messages

Follow conventional commits:

```bash
# Format: <type>(<scope>): <subject>

feat(auth): add JWT refresh token support
fix(api): resolve CORS issues with credentials
docs(readme): update installation instructions
style(frontend): format code with prettier
refactor(db): optimize user query performance
test(api): add tests for user endpoints
chore(deps): update dependencies
```

### Pull Request Workflow

```bash
# 1. Create feature branch
git checkout -b feature/amazing-feature

# 2. Make changes and commit
git add .
git commit -m "feat: add amazing feature"

# 3. Push to GitHub
git push origin feature/amazing-feature

# 4. Create pull request
gh pr create --title "Add amazing feature" \
  --body "## Description\nAdded amazing feature\n\n## Testing\n- [x] Unit tests pass\n- [x] Manual testing completed"

# 5. After review and approval, merge
gh pr merge --squash --delete-branch
```

## 🧪 Testing Strategy

### Test Structure

```
tests/
├── unit/           # Unit tests
├── integration/    # Integration tests
├── e2e/           # End-to-end tests
└── fixtures/      # Test data
```

### Backend Testing

```python
# tests/test_api/test_items.py
import pytest
from fastapi.testclient import TestClient
from sqlalchemy.orm import Session

from app.core.config import settings
from app.tests.utils.user import create_random_user
from app.tests.utils.item import create_random_item

def test_create_item(
    client: TestClient, 
    superuser_token_headers: dict, 
    db: Session
) -> None:
    data = {"title": "Foo", "description": "Fighters"}
    response = client.post(
        f"{settings.API_V1_STR}/items/",
        headers=superuser_token_headers,
        json=data,
    )
    assert response.status_code == 200
    content = response.json()
    assert content["title"] == data["title"]
    assert content["description"] == data["description"]
    assert "id" in content
    assert "owner_id" in content
```

### Frontend Testing

```javascript
// tests/components/UserProfile.test.js
import { render, screen, waitFor } from '@testing-library/react';
import { AuthProvider } from '../../contexts/AuthContext';
import UserProfile from '../../components/UserProfile';
import { userService } from '../../services/users';

jest.mock('../../services/users');

describe('UserProfile', () => {
  test('displays user profile information', async () => {
    const mockProfile = {
      full_name: 'John Doe',
      email: 'john@example.com',
      avatar: 'avatar.jpg'
    };
    
    userService.getProfile.mockResolvedValue(mockProfile);
    
    render(
      <AuthProvider>
        <UserProfile />
      </AuthProvider>
    );
    
    await waitFor(() => {
      expect(screen.getByText('John Doe')).toBeInTheDocument();
      expect(screen.getByText('john@example.com')).toBeInTheDocument();
    });
  });
});
```

## 📊 Monitoring Development

### Backend Monitoring

```python
# backend/app/api/endpoints/health.py
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.api import deps

router = APIRouter()

@router.get("/health")
def health_check(db: Session = Depends(deps.get_db)):
    # Check database
    try:
        db.execute("SELECT 1")
        db_status = "healthy"
    except Exception as e:
        db_status = f"unhealthy: {str(e)}"
    
    return {
        "status": "healthy" if db_status == "healthy" else "degraded",
        "database": db_status,
        "timestamp": datetime.utcnow(),
        "version": settings.PROJECT_VERSION
    }
```

### Frontend Monitoring

```javascript
// frontend/src/utils/monitoring.js
class PerformanceMonitor {
  constructor() {
    this.metrics = [];
  }
  
  measurePageLoad() {
    const perfData = window.performance.timing;
    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
    const connectTime = perfData.responseEnd - perfData.requestStart;
    const renderTime = perfData.domComplete - perfData.domLoading;
    
    this.metrics.push({
      type: 'page_load',
      pageLoadTime,
      connectTime,
      renderTime,
      timestamp: new Date().toISOString()
    });
    
    console.log('Page Load Metrics:', {
      pageLoadTime: `${pageLoadTime}ms`,
      connectTime: `${connectTime}ms`,
      renderTime: `${renderTime}ms`
    });
  }
  
  measureApiCall(endpoint, duration) {
    this.metrics.push({
      type: 'api_call',
      endpoint,
      duration,
      timestamp: new Date().toISOString()
    });
    
    if (duration > 1000) {
      console.warn(`Slow API call to ${endpoint}: ${duration}ms`);
    }
  }
}

export default new PerformanceMonitor();
```

## 🚀 Deployment Preparation

### Build Checklist

```bash
#!/bin/bash
# scripts/pre-deploy.sh

echo "🔍 Running pre-deployment checks..."

# 1. Run tests
echo "Running tests..."
docker-compose exec backend pytest
docker-compose exec frontend npm test

# 2. Check for linting issues
echo "Checking code quality..."
docker-compose exec backend flake8 app/
docker-compose exec frontend npm run lint

# 3. Build production images
echo "Building production images..."
docker-compose -f docker-compose.prod.yml build

# 4. Run security scan
echo "Running security scan..."
docker-compose exec backend safety check
docker-compose exec frontend npm audit

# 5. Check environment variables
echo "Verifying environment configuration..."
if [ ! -f .env.production ]; then
    echo "❌ Missing .env.production file"
    exit 1
fi

echo "✅ All checks passed!"
```

### Production Build

```bash
# Build for production
docker-compose -f docker-compose.prod.yml build

# Test production build locally
docker-compose -f docker-compose.prod.yml up

# Tag images for registry
docker tag myapp_backend:latest registry.example.com/myapp/backend:v1.0.0
docker tag myapp_frontend:latest registry.example.com/myapp/frontend:v1.0.0

# Push to registry
docker push registry.example.com/myapp/backend:v1.0.0
docker push registry.example.com/myapp/frontend:v1.0.0
```

## 📚 Best Practices

1. **Code Review** - All code must be reviewed before merging
2. **Testing** - Write tests for new features
3. **Documentation** - Update docs with code changes
4. **Small Commits** - Make atomic, focused commits
5. **Branch Protection** - Protect main branch, require PR reviews
6. **CI/CD** - Automate testing and deployment
7. **Security** - Regular dependency updates and security scans
8. **Performance** - Monitor and optimize performance
9. **Logging** - Comprehensive logging for debugging
10. **Backup** - Regular database backups

---

**Next**: [Docker Setup](Docker-Setup) →